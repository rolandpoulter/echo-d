!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.echoD=e():t.echoD=e()}("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,(()=>(()=>{"use strict";var t={d:(e,n)=>{for(var s in n)t.o(n,s)&&!t.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:n[s]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{Actor:()=>o,ArrayTypes:()=>at,BasicTypes:()=>ct,Changes:()=>H,Client:()=>u,Component:()=>i,ComponentsIndex:()=>F,Constants:()=>s,Context:()=>Qt,Core:()=>r,Emitter:()=>K,Entity:()=>c,Handler:()=>bt,Index:()=>q,IndexMap:()=>lt,Node:()=>l,Options:()=>qt,Ordered:()=>Ft,Pending:()=>Tt,SortedIndex:()=>T,SpatialIndex:()=>Q,Storage:()=>mt,Symbol:()=>a,Symbols:()=>N,createStorageProps:()=>ut,default:()=>Bt,ensureSymbolIndex:()=>$,extractSymbol:()=>B,getActionHandler:()=>dt,getSymbolAction:()=>pt,handler:()=>yt,manyHandler:()=>gt,oneHandler:()=>ft,recursiveSymbolExtraction:()=>J,recursiveSymbolIndexesEnsured:()=>W,updater:()=>ht,utils:()=>n});var n={};t.r(n),t.d(n,{binaryInsert:()=>g,binarySearch:()=>b,combineValues:()=>w,concatTypedArray:()=>h,createEnum:()=>S,differenceSets:()=>f,intersectionSets:()=>y,messageTuple:()=>A,now:()=>m,paginate:()=>C,recursiveCombination:()=>x,typeOf:()=>v,unionSetOrArray:()=>p,unionSets:()=>d});var s={};t.r(s),t.d(s,{Actions:()=>I,CommonComponents:()=>E,DefaultSymbols:()=>P,batchActionPayloadSizes:()=>j,defaultGetActorId:()=>V,defaultGetGroupedValue:()=>L,defaultOptions:()=>R,defaultSetGroupedValue:()=>M,defaultUpdateOptions:()=>z,defaultValidKeys:()=>_,enumActions:()=>k,enumCommonComponents:()=>D,enumDefaultSymbols:()=>U,padEnum:()=>O,voidResponder:()=>G});var o={};t.r(o),t.d(o,{ActorActions:()=>Y,ActorActionsFactory:()=>X,actions:()=>tt,default:()=>et});var i={};t.r(i),t.d(i,{ComponentActions:()=>st,ComponentActionsFactory:()=>nt,actions:()=>it,default:()=>rt});var r={};t.r(r),t.d(r,{CoreActions:()=>Ct,CoreActionsFactory:()=>At,actions:()=>vt,default:()=>wt});var c={};t.r(c),t.d(c,{EntityActions:()=>It,EntityActionsFactory:()=>xt,actions:()=>Pt,default:()=>Ot});var a={};t.r(a),t.d(a,{SymbolActions:()=>Dt,SymbolActionsFactory:()=>kt,actions:()=>jt,default:()=>Rt});var l={};t.r(l),t.d(l,{AllActionsFactory:()=>zt,NodeActions:()=>Gt,actions:()=>Lt,allActions:()=>_t,default:()=>Mt});var u={};function m(){return performance.timeOrigin+performance.now()}function h(t,e){if(Array.isArray(t)&&Array.isArray(e))return t.concat(e);if(Array.isArray(t)){const n=new e.constructor(t.length);n.set(t),t=n}else if(Array.isArray(e)){const n=new t.constructor(e.length);n.set(e),e=n}const n=new t.constructor(t.length+e.length);return n.set&&(n.set(t),n.set(e,t.length)),n}function p(...t){const e={};for(const n of t)if(n)for(const t of n)e[t]=!0;return Object.keys(e)}function d(t,e){if("function"==typeof t.union)return t.union(t);const n=new Set;for(const e of t)n.add(e);for(const t of e)n.add(t);return n}function f(t,e){if("function"==typeof t.difference)return t.difference(t);const n=new Set;for(const s of t)e.has(s)||n.add(s);return n}function y(t,e){if("function"==typeof t.intersection)return t.intersection(t);const n=new Set;for(const s of t)e.has(s)&&n.add(s);return n}function g(t,e,n=(t=>t)){let s=0,o=t.length;for(;s<o;){const i=s+o>>>1;n(t[i])<e?s=i+1:o=i}return s}function b(t,e,n=(t=>t)){let s=0,o=t.length-1;for(;s<=o;){const i=s+o>>>1,r=n(t[i]);if(r===e)return[i,s];r<e?s=i+1:o=i-1}return[-1,s]}function S(t,e=0){const n={};let s=e;if(t)for(const e of t)n[e]=s++;return n}function A(t){return[t?.action,t?.payload]}function C(t,e){if(e===1/0&&Array.isArray(t)&&t.length>0)return[t];const n=[];let s=[],o=0;for(const i of t)o>=e&&(n.push(s),s=[],o=0),s.push(i),o++;return s.length>0&&n.push(s),n}function v(t){const e=typeof t;if("object"===e){if(!t)return"null";if(Array.isArray(t))return"array"}return e}function w(t,e){return x(t,e)}function x(t,e){const n=v(t);switch(v(e)){case"bigint":case"number":return"number"!==n&&"bigint"!==n?[!1,e]:[!0,t+e];case"array":{if("array"!==n)return[!1,e];const s=[];let o=!0;for(let n=0;n<e.length;n+=1){const[i,r]=x(t[n],e[n]);s[n]=r,!1===i&&(o=!1)}return[o,s]}case"object":{if("object"!==n)return[!1,e];const s={};let o=!0;for(const n in e){const[i,r]=x(t[n],e[n]);!1===i&&(o=!1),s[n]=r}return[o,s]}default:return[!1,e]}}t.r(u),t.d(u,{ClientActions:()=>Ht,actions:()=>Kt,default:()=>Nt});const I=["actorInput","actors","addSymbol","batch","changeComponent","components","createEntity","entities","fetchSymbol","getSymbol","mergeActors","mergeComponents","mergeEntities","mergeSymbols","mergeSymbol","removeActor","removeComponent","removeEntity","spawnActor","symbol","symbols","upsertComponent"],E=["asset","collider","color","hidden","position","rotation","velocity","spin"],P=p(I,E),O=0,k=S(I,O),D=S(E,I.length+O),U=S(P,O),j={actorInput:{default:1,rollback:2},changeComponent:{default:3,ordered:4},mergeSymbols:2,removeComponent:2,upsertComponent:{default:3,ordered:4}},R={compressStringsAsInts:!0,enableRollback:!1,enableQuerying:!1,isAuthority:!0,isAsyncStorage:!1,isComponentRelay:!0,isDiffed:!1,isGroupedComponents:!1,isOrdered:!1,isReadOnly:!1,isSymbolLeader:!1,isSymbolRelay:!1,pageSize:100,skipPending:!1,indexes:{position:{type:"spatial"}},types:{asset:"str",collider:"str",color:["ui8",4],hidden:"bool",position:["f32",3],rotation:["f32",3],velocity:["f32",3],spin:["f32",3],size:["f32",3]}},z={mask:{actors:!0,entities:!0,components:!0,inputs:!0,symbols:!0}&&null,type:!0,batched:!0,batchSize:100},_={asset:!0,collider:!0,color:!0,hidden:!0,position:!0,rotation:!0,velocity:!0,spin:!0,size:!0};function G(){}function V(t,e){return t}function L(t,e,n,s){const o=n[s];return Array.isArray(o)?t.slice(e*o[1],(e+1)*o[1]):t[e]}function M(t,e,n){return t}class q{items;constructor(t=null,e={}){this.items=t}clear(){this.items=null}clone(){return new q(this.items)}get(t){}has(t,e){return!1}remove(t,e){}set(t,e){return null}store(t,e,n){return e&&this.remove(e,t),this.set(n,t)}query(t){return[]}}class F extends q{constructor(t={},e={}){super(t)}clear(){this.items={}}clone(){return new q(this.items)}get(t){return this.items[t]}has(t,e){const n=this.items[t];return!(!n||!n.has(e))}remove(t,e){const n=this.items[t];if(n&&n.has(e))return n.delete(e),!0}set(t,e){return this.items[t]=this.items[t]||new Set,!this.items[t].has(e)&&(this.items[t].add(e),!0)}union(t,e){return new F({...this.items,[t]:d(this.items[t],e.items[t])})}difference(t,e){return new F({...this.items,[t]:f(this.items[t],e.items[t])})}intersection(t,e){return new F({...this.items,[t]:y(this.items[t],e.items[t])})}query(t){const{with:e,without:n}=t||{};let s=new Set;if(e)for(const t of e){const e=this.items[t];e&&(s=d(s,e))}if(n)for(const t of n){const e=this.items[t];e&&(s=f(s,e))}return s}}class T extends q{constructor(t=[],e={}){super(t)}clear(){this.items=[]}clone(){return new T(this.items)}get(t){const e=this.items.find((e=>e[0]===t));return e?e[1]:[]}has(t,e){const n=this.items.find((e=>e[0]===t));return void 0===e?!!n:!!n&&-1!==n[1].indexOf(e)}remove(t,e){const n=function(t,e,n){if(!t)return[-1,-1];const s=g(t,e,(t=>t[0])),o=t[s];if(o===e){const e=o[1],i=e.lastIndexOf(n);if(-1!==i)return e.splice(i,1),0===e.length&&t.splice(s,1),[s,i]}return[-1,-1]}(this.items,t,e);return n}set(t,e){const n=function(t,e,n){if(!t)return[0,0];const s=g(t,e,(t=>t[0])),o=t[s];if(o!==e){const o=[n];return t.splice(s,0,[e,o]),[s,0]}{const t=o[1];if(-1===t.indexOf(n))return t.push(n),[s,t.length-1]}return[-1,-1]}(this.items,t,e);return n}query(t){return this.get(t)}}class Q extends q{constructor(t=[],{cellSize:e=5}={}){super(t),this.cellSize=e}clear(){this.items=[]}clone(){return new Q(this.items)}get(t){const e=this.hash(t);this.items[e]=this.items[e]||[];return this.items[e]||[]}has(t,e){const n=this.hash(t);this.items[n]=this.items[n]||[];const s=this.items[n];return void 0===e?!!s:!!s&&-1!==s.indexOf(e)}hash(t){return 2===t.length?this.hash2d(t[0],t[1]):this.hash3d(t[0],t[1],t[2])}hash2d(t=0,e=0){return 73856093*Math.floor((t+1e3)/this.cellSize)^19349663*Math.floor((e+1e3)/this.cellSize)}hash3d(t=0,e=0,n=0){return 73856093*Math.floor((t+1e3)/this.cellSize)^19349663*Math.floor((e+1e3)/this.cellSize)^83492791*Math.floor((n+1e3)/this.cellSize)}remove(t,e){const n=this.hash(t);this.items[n]=this.items[n]||[];const s=this.items[n],[o]=b(s,e);return-1===o&&s.splice(o,1),0===s.length&&delete this.items[n],[n,o]}set(t,e){const n=this.hash(t);this.items[n]=this.items[n]||[];const s=this.items[n],[o,i]=b(s,e);return-1===o&&s.splice(i,0,e),[n,o]}query(t){let e=[];const n=this.cellSize;if(2==(2===t.length?2:3)){const[s,o]=t;for(let t=2*-n;t<2*n+n;t+=n)for(let i=2*-n;i<2*n+n;i+=n){const n=this.items[this.hash2d(s+t,o+i)];void 0!==n&&(e=e.concat(n))}}else{const[s,o,i]=t;for(let t=2*-n;t<2*n+n;t+=n)for(let r=2*-n;r<2*n+n;r+=n)for(let c=2*-n;c<2*n+n;c+=n){const n=this.items[this.hash3d(s+t,o+r,i+c)];void 0!==n&&(e=e.concat(n))}}return e}}class H{context;diffs;constructor(t,e){this.context=t,this.diffs=e?.diffs||{}}changeComponent(t,e,n,s,o=!1){return this.upsertComponent(t,e,n,s,o)}getValue(t,e,n){const s=this.diffs[t]?.[e];return null==s?n:s}reset(t){return this.diffs=t?.diffs||{},this}upsertComponent(t,e,n,s,o=!1){this.diffs[t]=this.diffs[t]||{};const i=this.context.store.findComponents(t),r=[],c=s=>{if(null==s){this.diffs[t][e]=n;const s=this.context.store.storeComponent(t,e,n);return o&&s instanceof Promise&&r.push(s),n}let i=this.diffs[t];const c=(t,e,n,s)=>{let o=s;if(!n)return[e,o];const i=v(n[t]),r=v(o);if(i!==r)return e[t]=o,[e=e[t],o];switch(r){case"bigint":case"number":{const s=o-n[t];e[t]=s;break}case"array":e=e[t],n=n[t];for(let t=0;t<o.length;t+=1)c(t.toString(),e,n,o[t]);break;case"object":e=e[t],n=n[t];for(const t in o)c(t,e,n,o[t]);break;default:e[t]=o}return e=e[t],o=o[t],[e,s]};[i,n]=c(e,i,s,n);const a=this.context.store.storeComponent(t,e,n);return o&&a instanceof Promise&&r.push(a),n};return o&&i instanceof Promise?new Promise(((t,e)=>{i.then((s=>(c(s),0===r.length?Promise.all(r).then((()=>t(n)),e):t(n))))})):c(i)}}class K{handlers;emissions;handlersDone;emissionsDone;constructor(t=[],e=!1,n=[],s=!1){this.handlers=n,this.emissions=t;for(const t of this.handlers)for(const e of this.emissions)t(e);this.handlersDone=e,this.emissionsDone=s,this.cleanup()}cleanup(){this.handlersDone&&this.emissionsDone&&this.clear()}clear(){this.handlers=[],this.emissions=[],this.handlersDone=!1,this.emissionsDone=!1}done(t=!0,e=!0){this.handlersDone=t,this.emissionsDone=e,this.cleanup()}emitTo(t,e=!1){this.handlers.push(t);for(const e of this.emissions)t(e);this.handlersDone=e,this.cleanup()}emit(t,e=!1){this.emissions.push(t);for(const e of this.handlers)e(t);this.emissionsDone=e,this.cleanup()}removeHandler(t){const e=this.handlers.indexOf(t);-1!==e&&this.handlers.splice(e,1)}removeEmission(t){const e=this.emissions.indexOf(t);-1!==e&&this.emissions.splice(e,1)}}class N{_list;_enum;constructor(t={}){const{_list:e=[]}=t;this._list=e,this._enum=S(e)}add(t){if(t){if(Object.prototype.hasOwnProperty.call(this._enum,t))return this._enum[t];{const e=this._list.length;return this._list[e]=t,this._enum[t]=e,e}}return null}copyEnum(t={}){for(const e of Object.entries(t))this.merge(e)}fetch(t){let e,n;switch(typeof t){case"number":e=t,n=this._list[e]||"";break;case"string":n=t,e=Object.prototype.hasOwnProperty.call(this._enum,n)?this._enum[n]:-1}return[n,e]}find(t){return this._enum[t]}get(t){return this._list[t]}getSymbols(){return this._list}getSymbolsEnum(){return this._enum}merge(t){const[e,n]=t;this._list[n]=e,this._enum[e]=n}reset(t,e=[]){if(t>0){const{length:n}=e,{_list:s}=this,{_enum:o}=this;for(let i=0;i<n;i++){const n=e[i],r=i+t;s[r]=n,o[n]=r}}else this._list=e,this._enum=S(e)}}function B(t,e,n){if("number"==typeof t){const{actions:s}=n,{getSymbol:o}=s,i=o(t,e,n);if(!i)return"";t=i}return t}function $(t,e,n){if("string"==typeof t){const{actions:s}=n,{addSymbol:o}=s,i=o(t,e,n);if("number"==typeof i)return i}return t}function J(t,e,n,s){if("$"===t.charAt(0)){const{actions:t}=s,{getSymbol:o}=t,i=t=>{if(!Array.isArray(t)){switch(typeof t){case"number":{const e=o(t,n,s);e&&(t=e);break}case"object":for(const e in t)t[e]=i(t[e])}return t}t=t.map(i)};return i(e)}return e}function W(t,e,n,s){if("$"===t.charAt(0)){const{actions:t}=s,{addSymbol:o}=t,i=t=>{if(!Array.isArray(t)){switch(typeof t){case"string":{const e=o(t,n,s);"number"==typeof e&&(t=e);break}case"object":for(const e in t)t[e]=i(t[e])}return t}t=t.map(i)};return i(e)}return e}const X=(t=Object)=>class extends t{actorInput(t,e,n){n=qt.ensure(n,this);const{getActorId:s,compressStringsAsInts:o}=n;let i,r=0;Array.isArray(t)?(i=t[0],r=t[1]||0):i=t;let c=s(i?.id,e);null!=c&&""!==c&&(o&&(c=B(c,e,n),""===c)||(i?.id||(i.id=c),e.actorInput(c,i,r,n)))}actors(t,e,n){n=n=qt.ensure(n,this);const{responder:s,isAuthority:o,isAsyncStorage:i,pageSize:r,enableQuerying:c,enumDefaultSymbols:a}=n;if(!o)return;const l=t=>{for(const e of t)s([a.mergeActors,e])},u=e.getActors(c?t:null,r);i?u.emitTo(l,!0):l(u)}mergeActors(t,e,n){n=n=qt.ensure(n,this),e.mergeActors(t,n)}removeActor(t,e,n){n=n=qt.ensure(n,this);const{skipPending:s,getActorId:o,compressStringsAsInts:i}=n;null!=(t=o(t,e))&&""!==t&&(i&&""===(t=B(t,e,n))||e.removeActor(t,s))}spawnActor(t,e,n){n=n=qt.ensure(n,this);const{skipPending:s,getActorId:o,compressStringsAsInts:i}=n;null!=(t=o(t,e))&&""!==t&&(i&&""===(t=B(t,e,n))||e.spawnActor(t,s))}};class Y extends(X()){}const Z=new Y,tt={actorInput:Z.actorInput,actors:Z.actors,mergeActors:Z.mergeActors,removeActor:Z.removeActor,spawnActor:Z.spawnActor},et=tt,nt=(t=Object)=>class extends t{changeComponent(t,e,n){n=n=qt.ensure(n,this);const{compressStringsAsInts:s,types:o,isOrdered:i}=n;let[r,c,a]=t,l=i?t[3]:0;if(null!=r&&""!==r&&null!=c&&""!==c){if(s){if(r=B(r,e,n),!r)return;if(c=B(c,e,n),!c)return;const t=o[c];if(t&&(t===String||t[0]===String)&&(a=J(c,a,e,n),!a))return}return e.changeComponent(r,c,a,l,n)}}components(t,e,n){n=n=qt.ensure(n,this);const{responder:s,isAuthority:o,isAsyncStorage:i,pageSize:r,enableQuerying:c,enumDefaultSymbols:a}=n;if(!o)return;const l=t=>{for(const e of t)s([a.mergeComponents,e])},u=e.getComponents(c?t:null,r);i?u.emitTo(l,!0):l(u)}mergeComponents(t,e,n){n=n=qt.ensure(n,this),e.mergeComponents(t,n)}removeComponent(t,e,n){n=n=qt.ensure(n,this);const{compressStringsAsInts:s}=n;let[o,i]=t;if(null!=o&&""!==o&&null!=i&&""!==i){if(s){if(o=B(o,e,n),!o)return;if(i=B(i,e,n),!i)return}e.removeComponent(o,i,n)}}upsertComponent(t,e,n){n=n=qt.ensure(n,this);const{compressStringsAsInts:s,types:o,isOrdered:i}=n;let[r,c,a]=t,l=i?t[3]:0;if(null!=r&&""!==r&&null!=c&&""!==c){if(s){if(r=B(r,e,n),!r)return;if(c=B(c,e,n),!c)return;const t=o[c];if(t&&(t===String||t[0]===String)&&(a=J(c,a,e,n),!a))return}return e.upsertComponent(r,c,a,l,n)}}};class st extends(nt()){}const ot=new st,it={changeComponent:ot.changeComponent,components:ot.components,mergeComponents:ot.mergeComponents,removeComponent:ot.removeComponent,upsertComponent:ot.upsertComponent},rt=it,ct=new Map([["str",String],["num",Number],["bool",Boolean],["map",Map],["set",Set],["arr",Array]]),at=new Map([["i8",Int8Array],["ui8",Uint8Array],["ui8c",Uint8ClampedArray],["i16",Int16Array],["ui16",Uint16Array],["i32",Int32Array],["ui32",Uint32Array],["f32",Float32Array],["f64",Float64Array]]),lt={sorted:T,spatial:Q};function ut(t={},e={},n={}){const{actors:s=[],entities:o=[],components:i={},inputs:r={}}=e||{},{types:c={},indexes:a={}}=n;t.actors=s||[],t.entities=o||[],t.components=i||{},t.inputs=r||{},t.types=c,t.typeCtors={};for(let e in c){let n=c[e];Array.isArray(n)?n=ct.get(n[0])||at.get(n[0]):"string"==typeof n&&(n=ct.get(n)||at.get(n)),"function"==typeof n&&n&&(t.typeCtors[e]=n)}t.componentsIndex=new F,t.indexes={};for(let e in a){const{type:n}=a[e],s=lt[n];s&&(t.indexes[e]={actors:new s([],a[e]),entities:new s([],a[e])})}return t}class mt{constructor(t={},e={}){ut(this,t,e)}destroyActor(t){const e=this.actors;return this.destroyId(e,t)}destroyComponent(t,e){const n=this.components[t][e];delete this.components[t][e],this.removeComponentsIndex(t,e,n)}destroyEntity(t){const e=this.entities;return this.destroyId(e,t)}destroyId(t,e){const[n]=b(t,e);return-1!==n&&(t.splice(n,1),!0)}findComponents(t){return this.components[t]=this.components[t]||{},this.components[t]}findComponent(t,e){return this.components[t]=this.components[t]||{},this.components[t][e]}findInputs(t){return this.inputs[t]}findInput(t,e){this.inputs[t]=this.inputs[t]||[];const n=this.inputs[t][e];return Array.isArray(n)?[{...n[0],id:t},n[1]]:{...n,id:t}}getActors(t=null,e=1/0){if(null!==t){let n={};for(let e in t){const s=this.indexes[e];s&&s.actors.query(t[e]).forEach((t=>{n[t]=!0}))}return C(Object.keys(n),e)}return C(this.actors,e)}getComponents(t=null,e=1/0){let n=this.components;if(null!==t){const e={};for(let n of t)e[n]=this.components[n];n=e}return C(Object.keys(n),e).map((t=>{const e={};for(let s of t)e[s]=n[s];return e}))}getEntities(t=null,e=1/0){if(null!==t){let n={};for(let e in t){const s=this.indexes[e];s&&s.entities.query(t[e]).forEach((t=>{n[t]=!0}))}return C(Object.keys(n),e)}return C(this.entities,e)}getInputs(t=null,e=1/0){let n=this.inputs;if(null!==t){const e={};for(let n of t)e[n]=this.inputs[n];n=e}return C(Object.keys(n),e).map((t=>{const e={};for(let s of t)e[s]=n[s];return e}))}isActor(t){return-1!==this.actors.indexOf(t)}isEntity(t){return-1!==this.entities.indexOf(t)}setActors(t){return this.actors=t,t}setComponents(t){return this.components=t,t}setEntities(t){return this.entities=t,t}setInputs(t){return this.inputs=t,t}storeActor(t){const e=this.actors;return this.storeId(e,t)}storeComponent(t,e,n){const s=this.components[t][e];this.components[t][e]=n,this.updateComponentsIndex(t,e,s,n)}storeEntity(t){const e=this.entities;return this.storeId(e,t)}storeId(t,e){const[n,s]=b(t,e);return-1===n&&(t.splice(s,0,e),!0)}storeInput(t,e,n=0){const s=this.inputs;s[t]=s[t]||[];const o=s[t].length;return e.id===t&&delete e.id,s[t].push(n?[e,n]:e),o}queryComponents(t){return this.componentsIndex.query(t)}removeComponentsIndex(t,e,n){if(this.componentsIndex.remove(t,e),this.indexes[e]){const s=this.indexes[e];this.isActor(t)?s.actors.remove(t,n):s.entities.remove(t,n)}}updateComponentsIndex(t,e,n,s){if(this.componentsIndex.set(t,e),this.indexes[e]){const o=this.indexes[e];this.isActor(t)?o.actors.store(t,n,s):o.entities.store(t,n,s)}}}async function ht(t,e,n=m()){e=e instanceof qt?e:new qt(e);const{responder:s,enumDefaultSymbols:o,compressStringsAsInts:i,enableRollback:r,isOrdered:c,isDiffed:a,isGroupedComponents:l,isAsyncStorage:u,types:p,setGroupedValue:d,updateOptions:f}=e,{batched:y,batchSize:g,mask:b,type:S,validKeys:A}=f;if(!t.pending)return[];const C=[];let v=[];const{created:w={},removed:x={},symbols:I=[],updated:E={}}=t.pending,P=t.store,O=t=>{y&&v.length&&(C.push([t,...v]),v=[])},k=async(n,o)=>{y?(v=v.concat(o),v.length>=g&&O(n)):(i&&(n=$(n,t,e)),await s([n,o],S))},D=n=>(i&&(n=$(n,t,e)),n),U=async(s={},r)=>{const m=l?{}:null;for(const l in s??{}){if(null==(u?await P.findComponents(l):P.findComponents(l)))break;const f=s?s[l]:{};for(const s in f??{}){if(A&&!A[s])break;const f=p[s]??null,y=f?at.get(Array.isArray(f)?f[0]:f):null;let g=null;m&&(g=m[s]=m[s]??{key:s,ids:i?new Uint32Array(0):[],intIds:!0,values:y?new y(0):[],ticks:new Uint32Array(0)});let b=u?await P.findComponent(l,s):P.findComponent(l,s);a&&t.changes&&"updated"===r&&(b=t.changes.getValue(l,s,b)),i&&(b=W(s,b,t,e));const S=D(l),C=D(s);if(m){g.ids=i?h(g.ids,[S]):g.ids.concat([l]),S===l&&(g.intIds=!1),g.values=y?h(g.values,d(b,p,s)):g.values.concat(d(b,p,s)),c&&(g.ticks=h(g.ticks,[a?-n:n]));continue}const v=[S,C,b];c&&v.push(a?-n:n),a?await k(o.changeComponent,v):await k(o.upsertComponent,v)}}if(m)for(const t in m){const e=m[t],n=i&&e.intIds?new Uint32Array(e.ids):e.ids,s=p[t]??null,r=s?at.get(Array.isArray(s)?s[0]:s):null,l=r?new r(e.values):e.values;let u=0;const h=n.length;for(;u<h;u+=g){const t=[n.slice(u,u+g),e.key,l.slice(u,u+g)];if(c){const n=new Uint32Array(e.ticks.slice(u,u+g));t.push(n)}a?await k(o.changeComponent,t):await k(o.upsertComponent,t)}}O(a?o.changeComponent:o.upsertComponent)};if(!b||!b.entities){for(const t of w.entities??[]){const e=D(t);await k(o.createEntity,e)}O(o.createEntity),w.entities=[]}if(!b||!b.actors){for(const t in w.actors??{}){const e=D(t);await k(o.spawnActor,e)}O(o.spawnActor),w.actors={}}if(!b||!b.entities){for(const t of x.entities??[]){const e=D(t);await k(o.removeEntity,e)}O(o.removeEntity),x.entities=[]}if(!b||!b.actors){for(const t in x.actors??{}){const e=D(t);await k(o.removeActor,e)}O(o.removeActor),x.actors={}}if(!b||!b.components){for(const t in x.components??{}){const e=x?.components?x.components[t]:null;if(!e)break;const n=D(t);for(const t in e){if(A&&!A[t])break;const e=[n,D(t)];await k(o.removeComponent,e)}}O(o.removeComponent),x.components={}}if(!b||!b.components){const t=U(w.components,"created");w.components={},await t}if(!b||!b.components){const t=U(E.components,"updated");E.components={},await t}if(!b||!b.inputs){for(const t in w.inputs??{}){const e=w?.inputs?w.inputs[t]??[]:[];for(let s=0;s<e.length;s+=1){const i=e[s],c=u?await P.findInput(t,i):P.findInput(t,i),a=Array.isArray(c),l=a?c[0]:c,m=a?c[1]:n;await k(o.actorInput,a||r?[l,m]:l)}}O(o.actorInput),w.inputs={}}if(!b||!b.symbols){for(const t of I){if(y)v.push(t);else{const e=[o.mergeSymbol,t];await s(e,S)}v.length>=g&&v.length&&(C.unshift([o.mergeSymbol].concat(v)),v=[])}y&&v.length&&(C.unshift([o.mergeSymbol].concat(v)),v=[]),t.pending.symbols=[]}if(y&&C.length)for(let t=0;t<C.length;t+=1){const e=C[t];e&&await s([o.batch,e])}return C}function pt(t,e){return e&&"number"==typeof t&&e[t]&&(t=e[t]),t}function dt(t,e){e=e instanceof qt?e:new qt(e);const{actions:n,defaultSymbols:s}=e;return o=>{o=pt(o,s);const i=s=>{n[o]&&n[o](s,t,e)};return i.action=o,i}}function ft(t,e,n){const s=dt(e,n=n instanceof qt?n:new qt(n));Array.isArray(t)?s(t[0])(t[1]):t&&s(t.action)(t.payload)}const yt=gt;function gt(t,e,n){n=n instanceof qt?n:new qt(n);const{batchActionPayloadSizes:s,isOrdered:o,enableRollback:i}=n,r=dt(e,n),c=(t,r,c=0)=>{const a=r.action;let l=s[a]||1;l&&"object"==typeof l&&(l=l.ordered&&o?l.ordered:l.rollback&&i?l.rollback:l.default);for(let o=c;o<t.length;o+=l)1===l?r(t[o],e,n):s&&r(t.slice(o,o+l),e,n)};if(Array.isArray(t))c(t,r(t[0]),1);else if(t){const e=r(t.action);c(t.payload,e)}}class bt{context;options;constructor(t,e,n,s=mt){this.options=qt.ensure(e,n),this.context=Qt.ensure(t,e,s)}one(t,e){return ft(t,this.context,e?this.options.extend(e):this.options)}many(t,e){return gt(t,this.context,e?this.options.extend(e):this.options)}getActionHandler(){return dt(this.context,this.options)}getSymbolAction(t){return pt(t,this.options.defaultSymbols)}updater(t,e=m()){return ht(this.context,t?this.options.extend(t):this.options,e)}spawnActor(t,e){return this.context.spawnActor(t,e?this.options.extend(e):this.options)}removeActor(t,e){return this.context.removeActor(t,e?this.options.extend(e):this.options)}actorInput(t,e,n=m(),s){return this.context.actorInput(t,e,n,s?this.options.extend(s):this.options)}createEntity(t,e){return this.context.createEntity(t,e?this.options.extend(e):this.options)}removeEntity(t,e){return this.context.removeEntity(t,e?this.options.extend(e):this.options)}upsertComponent(t,e,n,s=m(),o){return this.context.upsertComponent(t,e,n,s,o?this.options.extend(o):this.options)}changeComponent(t,e,n,s=m(),o){return this.context.changeComponent(t,e,n,s,o?this.options.extend(o):this.options)}removeComponent(t,e,n){return this.context.removeComponent(t,e,n?this.options.extend(n):this.options)}queryComponents(t){return this.context.store.queryComponents(t)}}const St=bt,At=(t=Object)=>class extends t{batch(t,e,n){gt(t,e,n=n=qt.ensure(n,this))}};class Ct extends(At()){}const vt={batch:(new Ct).batch},wt=vt,xt=(t=Object)=>class extends t{createEntity(t,e,n){n=n=qt.ensure(n,this);const{skipPending:s,compressStringsAsInts:o}=n;null!=t&&""!==t&&(o&&""===(t=B(t,e,n))||e.createEntity(t,s))}entities(t,e,n){n=n=qt.ensure(n,this);const{responder:s,isAuthority:o,isAsyncStorage:i,pageSize:r,enableQuerying:c,enumDefaultSymbols:a}=n;if(!o)return;const l=t=>{for(const e of t)s([a.mergeEntities,e])},u=e.getEntities(c?t:null,r);i?u.emitTo(l,!0):l(u)}mergeEntities(t,e,n){n=n=qt.ensure(n,this),e.mergeEntities(t,n)}removeEntity(t,e,n){n=n=qt.ensure(n,this);const{skipPending:s,compressStringsAsInts:o}=n;null!=t&&""!==t&&(o&&""===(t=B(t,e,n))||e.removeEntity(t,s))}};class It extends(xt()){}const Et=new It,Pt={createEntity:Et.createEntity,entities:Et.entities,mergeEntities:Et.mergeEntities,removeEntity:Et.removeEntity},Ot=Pt,kt=(t=Object)=>class extends t{addSymbol(t,e,n){return n=n=qt.ensure(n,this),e.addSymbol(t,n)}fetchSymbol(t,e,n){n=n=qt.ensure(n,this);const{responder:s,enumDefaultSymbols:o}=n;return e.fetchSymbol(t,n,(t=>{s([o.mergeSymbol,t])}))}getSymbol(t,e,n){return n=n=qt.ensure(n,this),e.getSymbol(t,n)}mergeSymbol(t,e,n){n=n=qt.ensure(n,this),e.mergeSymbol(t,n)}mergeSymbols(t,e,n){n=n=qt.ensure(n,this);const[s,o]=t;t&&t.length&&e.resetSymbols(s,o,n)}symbol(t,e,n){n=n=qt.ensure(n,this);const{actions:s,responder:o,isAuthority:i,enumDefaultSymbols:r,compressStringsAsInts:c}=n;if(!i||!c)return;const a=e.symbolsEnum??{};let l=Object.prototype.hasOwnProperty.call(a,t)?a[t]:-1;-1===l&&(l=s.addSymbol(t,e,n)),-1!==l&&o([r.mergeSymbol,[t,l]])}symbols(t,e,n){n=n=qt.ensure(n,this);const{responder:s,isAuthority:o,pageSize:i,enumDefaultSymbols:r,compressStringsAsInts:c}=n;if(!o||!c)return;const a=e.symbolsList;if(a&&a.length){const t=C(a,i);let e=0;for(const n of t)s([r.mergeSymbols,e,n]),e+=i}}};class Dt extends(kt()){}const Ut=new Dt,jt={addSymbol:Ut.addSymbol,fetchSymbol:Ut.fetchSymbol,getSymbol:Ut.getSymbol,mergeSymbol:Ut.mergeSymbol,mergeSymbols:Ut.mergeSymbols,symbol:Ut.symbol,symbols:Ut.symbols},Rt=jt;function zt(t=Object){return X(nt(At(xt(kt(t)))))}const _t={...et,...rt,...wt,...Ot,...Rt};class Gt extends(zt()){}const Vt=new Gt,Lt={actorInput:Vt.actorInput,actors:Vt.actors,mergeActors:Vt.mergeActors,removeActor:Vt.removeActor,spawnActor:Vt.spawnActor,changeComponent:Vt.changeComponent,components:Vt.components,mergeComponents:Vt.mergeComponents,removeComponent:Vt.removeComponent,upsertComponent:Vt.upsertComponent,batch:Vt.batch,createEntity:Vt.createEntity,entities:Vt.entities,mergeEntities:Vt.mergeEntities,removeEntity:Vt.removeEntity,addSymbol:Vt.addSymbol,fetchSymbol:Vt.fetchSymbol,getSymbol:Vt.getSymbol,mergeSymbol:Vt.mergeSymbol,mergeSymbols:Vt.mergeSymbols,symbol:Vt.symbol,symbols:Vt.symbols},Mt=Lt;class qt{actions;batchActionPayloadSizes;compressStringsAsInts;defaultSymbols;enableRollback;enableQuerying;enumDefaultSymbols;getActorId;getGroupedValue;indexes;isAuthority;isAsyncStorage;isComponentRelay;isDiffed;isGroupedComponents;isOrdered;isReadOnly;isSymbolLeader;isSymbolRelay;onUpdate;pageSize;responder;skipPending;types;setGroupedValue;storeOptions;updateOptions;worldOptions;static ensure(t={},e){return t instanceof qt?t:new qt(t,e)}constructor(t={},e=null){const{actions:n=e||Lt,batchActionPayloadSizes:s=j,compressStringsAsInts:o=R.compressStringsAsInts,defaultSymbols:i=P,enableRollback:r=R.enableRollback,enableQuerying:c=R.enableQuerying,enumDefaultSymbols:a=U,getActorId:l=V,getGroupedValue:u=L,indexes:m=R.indexes,isAuthority:h=R.isAuthority,isAsyncStorage:p=R.isAsyncStorage,isComponentRelay:d=R.isComponentRelay,isDiffed:f=R.isDiffed,isGroupedComponents:y=R.isGroupedComponents,isOrdered:g=R.isOrdered,isReadOnly:b=R.isReadOnly,isSymbolLeader:S=R.isSymbolLeader,isSymbolRelay:A=R.isSymbolRelay,onUpdate:C=null,pageSize:v=R.pageSize,responder:w=G,skipPending:x=R.skipPending,types:I=R.types,setGroupedValue:E=M,storeOptions:O={},updateOptions:k={},worldOptions:D=null}=t,q={...z,...k};q.validKeys=k?.validKeys?{..._,...k?.validKeys||{}}:null,this.actions=n,this.batchActionPayloadSizes=s,this.compressStringsAsInts=o,this.defaultSymbols=i,this.enableRollback=r,this.enableQuerying=c,this.enumDefaultSymbols=a,this.getActorId=l,this.getGroupedValue=u,this.indexes=m,this.isAuthority=h,this.isAsyncStorage=p,this.isComponentRelay=d,this.isDiffed=f,this.isGroupedComponents=y,this.isOrdered=g,this.isReadOnly=b,this.isSymbolLeader=S,this.isSymbolRelay=A,this.onUpdate=C,this.pageSize=v,this.responder=w,this.skipPending=x,this.types=I,this.setGroupedValue=E,this.storeOptions=O,this.updateOptions=q,this.worldOptions=D}clone(){return new qt({...this},this.actions)}extend(t,e=this.actions){return new qt({...this,...t},e)}}class Ft{order;constructor(t={}){this.order=t}changeComponent(t,e,n){return this.upsertComponent(t,e,n)}reset(t={}){this.order=t}upsertComponent(t,e,n){if(isNaN(n))return!1;if(this.order=this.order||{},this.order[t]=this.order[t]||{},"number"==typeof this.order[t][e]){if(isFinite(this.order[t][e])&&this.order[t][e]<=n){const s=0;return!(n>m()+s||(this.order[t][e]=n,0))}return!1}return this.order[t][e]=n,!0}}class Tt{constructor(t=!1){this.created={actors:{},components:{},entities:[],inputs:{}},this.removed={actors:{},components:{},entities:[]},this.updated={components:{}},this.symbols=[],this.isDiffed=t}actorInput(t,e){this.created.inputs[t]=this.created.inputs[t]||[],this.created.inputs[t].push(e)}changeComponent(t,e,n){return this.upsertComponent(t,e,n)}createEntity(t){this.created.entities.push(t)}removeActor(t){this.removed.actors[t]=!0}removeComponent(t,e){this.removed.components[t]=this.removed.components[t]||{},this.removed.components[t][e]=!0}removeEntity(t){this.removed.entities.push(t)}reset(){this.constructor()}spawnActor(t){this.created.actors[t]=!0}upsertComponent(t,e,n){const s="created"===t?this.created:this.updated;if(s){if("updated"===t&&this.created.components[e]&&this.created.components[e][n])return;s.components[e]=s.components[e]||{},s.components[e][n]=!0}}addSymbol(t){this.symbols.push(t)}replaceSymbols(t,e){if(t>0){const{length:n}=e,{symbols:s}=this;for(let o=0;o<n;o++){const n=e[o],i=o+t;s[i]=[n,i]}}else this.symbols=e.map(((t,e)=>[t,e]))}}class Qt{static ensure(t,e,n=mt){return t instanceof Qt?t:new Qt(t,e,n)}constructor(t={},e,n=mt){const{events:s=null,store:o=null,order:i=null,changes:r=null,symbols:c=null,pending:a=null}=t;e=qt.ensure(e,e?.actions||_t);const{isOrdered:l,isDiffed:u,isReadOnly:m,compressStringsAsInts:h,enableQuerying:p,enumDefaultSymbols:d,storeOptions:f,indexes:y,types:g}=e;this.order=l?new Ft(i):null,this.changes=u?new H(this,r):null,h?c?this.symbols=new N(c):(this.symbols=new N,this.symbols.copyEnum(d)):this.symbols=null,this.pending=m?null:a||new Tt(u),this.events=s,this.store=o||new n(void 0,{...f||{},types:g,indexes:p?y:null})}get actors(){const t=this.getActors(null,1/0);return t instanceof K?t:t[0]}getActors(t,e){return this.store.getActors(t,e)}spawnActor(t,e){const{skipPending:n,isAsyncStorage:s,onUpdate:o}=e,i=this.store.storeActor(t),r=e=>{e&&(!n&&this.pending&&this.pending.spawnActor(t),this.events&&this.events.emit("spawnActor",t),o&&o())};return s&&i instanceof Promise?(i.then(r),i):(r(i),i)}removeActor(t,e){const{skipPending:n,isAsyncStorage:s,onUpdate:o}=e,i=this.store.destroyActor(t),r=e=>{e&&(!n&&this.pending&&this.pending.removeActor(t),this.events&&this.events.emit("removeActor",t),o&&o())};return s&&i instanceof Promise?(i.then(r),i):(r(i),i)}mergeActors(t,e){const{actions:n,isAsyncStorage:s,onUpdate:o}=e,i=e.extend({onUpdate:null}),r=[];for(const e of t){const t=n.spawnActor(e,this,i);s&&t instanceof Promise&&r.push(t)}const c=()=>{o&&o()};if(s&&r.length>0){const t=r.length?Promise.all(r):Promise.resolve([]);return t.then(c),t}c()}get entities(){const t=this.getEntities(null,1/0);return t instanceof K?t:t[0]}getEntities(t,e){return this.store.getEntities(t,e)}createEntity(t,e){const{skipPending:n,isAsyncStorage:s,onUpdate:o}=e,i=this.store.storeEntity(t),r=e=>{e&&(!n&&this.pending&&this.pending.createEntity(t),this.events&&this.events.emit("createEntity",t),o&&o())};return s&&i instanceof Promise?(i.then(r),i):(r(i),i)}removeEntity(t,e){const{skipPending:n,isAsyncStorage:s,onUpdate:o}=e,i=this.store.destroyEntity(t),r=e=>{e&&(!n&&this.pending&&this.pending.removeEntity(t),this.events&&this.events.emit("removeEntity",t),o&&o())};return s&&i instanceof Promise?(i.then(r),i):(r(i),i)}mergeEntities(t,e){const{actions:n,isAsyncStorage:s,onUpdate:o}=e,i=e.extend({onUpdate:null}),r=[];for(const e of t){const t=n.createEntity(e,this,i);s&&t instanceof Promise&&r.push(t)}const c=()=>{o&&o()};if(s&&r.length>0){const t=r.length?Promise.all(r):Promise.resolve([]);return t.then(c),t}c()}get components(){const t=this.getComponents(null,1/0);return t instanceof K?t:t[0]}getComponents(t,e){return this.store.getComponents(t,e)}changeComponent(t,e,n,s=0,o){const{actions:i,skipPending:r,isAsyncStorage:c,isGroupedComponents:a,getGroupedValue:l,types:u,onUpdate:m}=o,h=()=>{m&&m()};if(Array.isArray(t)||t instanceof Uint32Array){if(!a)throw new Error("Cannot change grouped components without isGroupedComponents option");const r=o.extend({onUpdate:null}),m=[];for(let o=0;o<t.length;o++){const a=l(n,o,u,e),h=i.changeComponent([t[o],e,a,s],this,r);c&&h instanceof Promise&&m.push(h)}if(c&&m.length>0){const t=m.length?Promise.all(m):Promise.resolve([]);return t.then(h),t}return void h()}const p=this.store.findComponent(t,e),d=o=>{const i=void 0===o?"created":"updated";if(this.order&&!this.order.changeComponent(t,e,s)&&!this.changes)return;let a;"created"===i?a=n:[,a]=w(o,n);let l=null;l=this.changes?this.changes.changeComponent(t,e,a,n,c):this.store.storeComponent(t,e,a);const u=()=>{!r&&this.pending&&this.pending.changeComponent(i,t,e),this.events&&this.events.emit("changeComponent",t,e),h()};if(c&&l instanceof Promise)return l.then(u),l;u()};return c&&p instanceof Promise?(p.then(d),p):(d(p),p)}upsertComponent(t,e,n,s=0,o){const{actions:i,skipPending:r,isAsyncStorage:c,isGroupedComponents:a,getGroupedValue:l,types:u,onUpdate:m}=o,h=()=>{m&&m()};if(Array.isArray(t)||t instanceof Uint32Array){if(!a)throw new Error("Cannot upsert grouped components without isGroupedComponents option");const r=o.extend({onUpdate:null}),m=[];for(let o=0;o<t.length;o++){const a=l(n,o,u,e),h=i.upsertComponent([t[o],e,a,s],this,r);c&&h instanceof Promise&&m.push(h)}if(c&&m.length>0){const t=m.length?Promise.all(m):Promise.resolve([]);return t.then(h),t}return void h()}const p=this.store.findComponent(t,e),d=o=>{if(o!==n){if(this.order&&!this.order.upsertComponent(t,e,s)&&!this.changes)return;let i=null;i=this.changes?this.changes.upsertComponent(t,e,n,o,c):this.store.storeComponent(t,e,n);const a=()=>{if(!r&&this.pending){const n=void 0===o?"created":"updated";this.pending.upsertComponent(n,t,e)}this.events&&this.events.emit("upsertComponent",t,e),h()};if(c&&i instanceof Promise)return i.then(a),i;a()}};return c&&p instanceof Promise?(p.then(d),p):(d(p),p)}removeComponent(t,e,n){const{skipPending:s,isAsyncStorage:o,onUpdate:i}=n,r=this.store.findComponent(t,e),c=n=>(void 0!==n||null!==n)&&(this.store.destroyComponent(t,e),!s&&this.pending&&this.pending.removeComponent(t,e),this.events&&this.events.emit("removeComponent",t,e),i&&i(),!0);return o&&r instanceof Promise?new Promise(((t,e)=>{r.then((e=>{t(c(e))}),e)})):c(r)}mergeComponents(t,e){const{actions:n,isAsyncStorage:s,isComponentRelay:o,onUpdate:i}=e,r=e.extend({skipPending:!o,onUpdate:null}),c=[];for(const e in t??{})for(const s in t[e]){const o=[e,s,t[e][s]],i=n.upsertComponent(o,this,r);i instanceof Promise&&c.push(i)}const a=()=>{i&&i()};if(s&&c.length>0){const t=c.length?Promise.all(c):Promise.resolve([]);return t.then(a),t}a()}get inputs(){const t=this.getInputs(null,1/0);return t instanceof K?t:t[0]}getInputs(t,e){return this.store.getInputs(t,e)}actorInput(t,e,n=0,s){const{skipPending:o,isAsyncStorage:i,enableRollback:r,onUpdate:c}=s;n=r?n||m():0;const a=this.store.storeInput(t,e,n),l=s=>{!o&&this.pending&&this.pending.actorInput(t,s),this.events&&this.events.emit("actorInput",t,e,s,n),c&&c()};return i&&a instanceof Promise?(a.then(l),a):(l(a),a)}get symbolsList(){return this.symbols?.getSymbols()}get symbolsEnum(){return this.symbols?.getSymbolsEnum()}setSymbols(t){this.symbols?.reset(t)}getSymbol(t,e){const{actions:n}=e,s=this.symbols?.get(t);return s||n.fetchSymbol(s,this,e)[0]}addSymbol(t,e){if(null===this.symbols)return null;const{actions:n,isSymbolLeader:s,skipPending:o,onUpdate:i}=e,r=this.symbolsEnum??{};let c=Object.prototype.hasOwnProperty.call(r,t)?r[t]:-1;return-1===c&&(s?(c=this.symbols.add(t)??-1,!o&&this.pending&&this.pending.addSymbol([t,c]),i&&i()):n.fetchSymbol&&(c=n.fetchSymbol(t,this,e)[1])),-1===c?null:c}fetchSymbol(t,e,n){if(null===this.symbols)return null;const{isSymbolLeader:s,skipPending:o,onUpdate:i}=e,r=this.symbols.fetch(t);if(r[0]&&-1!==r[1])n&&n(r);else if(s){const t=this.symbols.add(r[0]);r[1]=t,!o&&this.pending&&this.pending.addSymbol(r),i&&i()}return r}mergeSymbol(t,e){if(null===this.symbols)return null;const{isSymbolLeader:n,isSymbolRelay:s,skipPending:o,onUpdate:i}=e;this.symbols.merge(t),(n||s)&&!o&&this.pending&&this.pending.addSymbol(t),i&&i()}resetSymbols(t=0,e,n){if(null===this.symbols)return null;const{isSymbolLeader:s,isSymbolRelay:o,skipPending:i,onUpdate:r}=n;this.symbols.reset(t,e),(s||o)&&!i&&this.pending&&this.pending.replaceSymbols(t,e),r&&r()}resetFrame(){this.pending&&this.pending.reset(),this.order&&this.order.reset(),this.changes&&this.changes.reset()}}class Ht extends Gt{actors(){}components(){}entities(){}symbol(){}symbols(){}}const Kt={...Mt,actors:null,components:null,entities:null,symbol:null,symbols:null},Nt=Kt,Bt=St;return e})()));
//# sourceMappingURL=lib.echo-d.min.js.map