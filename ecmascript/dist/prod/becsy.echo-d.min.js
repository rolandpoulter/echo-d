"use strict";!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.echoD=e():t.echoD=e()}("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,(()=>(Object("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).webpackChunkechoD=Object("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).webpackChunkechoD||[]).push([[565],{437:(t,e,n)=>{n.a(t,(async(t,s)=>{try{n.r(e),n.d(e,{BecsyStorage:()=>c});var o=n(20),r=n(174),i=n(464);const{World:t}=await n.e(232).then(n.bind(n,232));class c extends o.H{constructor(e,n){super({...e||{},actors:new Map,components:new Map,entities:new Map,inputs:null},n);const{worldOptions:s={defs:[]},world:o=null}=n;for(let t in this.types){const e=this.types[t];if("string"==typeof e[0])this.components.set(t,e[2]);else switch(e){case Boolean:case Number:case String:this.components.set(t,new Map)}}s&&!s.defs&&(s.defs=[]);for(let t of this.components.values())t&&(t instanceof Map||-1===s.defs.indexOf(t)&&s.defs.push(t));this.worldOptions=s,this.world=o||t.create(this.worldOptions)}async cleanup(){const t=await this.world;try{t.__dispatcher.registry.releaseComponentTypes(),await t.terminate()}catch(t){}}derefEntity(t){return this.actors.has(t)?this.actors.get(t):this.entities.has(t)?this.entities.get(t):void 0}async destroyActor(t){return this.destroyId(this.actors,t)}async destroyComponent(t,e){const n=this.derefEntity(t),s=this.components.get(e);if(null==n||!s)return;const o=()=>{const n=this.findComponent(t,e);this.removeComponentsIndex(t,e,n)};s instanceof Map?(s.get(t)&&s.delete(t),o()):o()}async destroyEntity(t){return this.destroyId(this.entities,t)}async destroyId(t,e){const n=t.get(e);return!!n&&(n.delete(),t.delete(e),!0)}async findComponents(t){const e=this.derefEntity(t);if(null!=e)return e}findComponent(t,e){const n=void 0;return this.findComponentProcess(t,e,n,n)}findComponentProcess(t,e,n,s){if(n=null==n?this.derefEntity(t):n,s=s||this.components.get(e),null!=n&&s){if(s instanceof Map)return s.get(t);{const t=this.types[e],o=t[3],i=new(r.X.get(t[0]))(t[1]),c=n.has(s)?n.read(s):void 0;let l=0;if(null==c)return i;for(let t in o){if("$val"===t){i.set(c);break}i[l]=c[t],l++}return i}}}getActors(t=null,e){if(null!==t)return super.getActors(t,e);const n=Array.from(this.actors.keys());return(0,i.paginate)(n,e)}getComponents(t=null,e){let n;n=null!==t?t:[...this.actors.keys(),...this.entities.keys()];return(0,i.paginate)(n,e).map((t=>{const e={};for(let n of t){const t=this.derefEntity(n);if(null==t)continue;const s=this.componentsIndex.get(n),o={};for(let e of s)o[e]=this.findComponentProcess(n,e,t,void 0);e[n]=o}return e}))}getEntities(t=null,e){if(null!==t)return super.getEntities(t,e);const n=this.entities.keys();return(0,i.paginate)(n,e)}getInputs(t=null,e){return super.getInputs(t,e)}isActor(t){return this.actors.has(t)}isEntity(t){return this.entities.has(t)}async setActors(t){return super.setActors(t)}async setComponents(t){return super.setComponents(t)}async setEntities(t){return super.setEntities(t)}async setInputs(t){return super.setInputs(t)}async storeActor(t){return await this.storeId(this.actors,t)}async storeComponent(t,e,n){const s=this.derefEntity(t);if(null!=s){const o=this.components.get(e);if(!o)return;s.has(o)||s.add(o,{});let r=[];if(o instanceof Map)r=o.get(t),o.set(t,n);else{const t=this.types[e][3],r=s.write(o);let i=0;for(let e in t){if("$val"===e){r.set(n);break}r[e]=n[i],i++}}await this.updateComponentsIndex(t,e,r,n)}}async storeEntity(t){return await this.storeId(this.entities,t)}async storeId(t,e){if(null==t.get(e)){const n=(await this.world).__dispatcher.createEntity([]),s=n.__registry.holdEntity(n.__id);return t.set(e,s),!0}return!1}async storeInput(t,e,n=(0,i.now)()){return super.storeInput(t,e,n)}}s()}catch(t){s(t)}}),1)},20:(t,e,n)=>{n.d(e,{H:()=>r});var s=n(699);const o=s.Ke.prototype;class r{constructor(t={},e={}){(0,s.gW)(this,t,e)}async destroyActor(t){return o.destroyActor.call(this,t)}async destroyComponent(t,e){return o.destroyComponent.call(this,t,e)}async destroyEntity(t){return o.destroyEntity.call(this,t)}async destroyId(t,e){return o.destroyId.call(this,t,e)}async findComponents(t){return o.findComponents.call(this,t)}async findComponent(t,e){return o.findComponent.call(this,t,e)}async findInputs(t){return o.findInputs.call(this,t)}async findInput(t,e){return o.findInput.call(this,t,e)}getActors(t=null,e=1/0){return o.getActors.call(this,t,e)}getComponents(t=null,e=1/0){return o.getComponents.call(this,t,e)}getEntities(t=null,e=1/0){return o.getEntities.call(this,t,e)}getInputs(t=null,e=1/0){return o.getInputs.call(this,t,e)}isActor(t){return o.isActor.call(this,t)}isEntity(t){return o.isEntity.call(this,t)}async setActors(t){return o.setActors.call(this,t)}async setComponents(t){return o.setComponents.call(this,t)}async setEntities(t){return o.setEntities.call(this,t)}async setInputs(t){return o.setInputs.call(this,t)}async storeActor(t){return o.storeActor.call(this,t)}async storeComponent(t,e,n){return o.storeComponent.call(this,t,e,n)}async storeEntity(t){return o.storeEntity.call(this,t)}async storeId(t,e){return o.storeId.call(this,t,e)}async storeInput(t,e,n=0){return o.storeInput.call(this,t,e,n)}queryComponents(t){return o.queryComponents.call(this,t)}removeComponentsIndex(t,e,n){o.removeComponentsIndex.call(this,t,e,n)}updateComponentsIndex(t,e,n,s){o.updateComponentsIndex.call(this,t,e,n,s)}}}},t=>(437,t(t.s=437))])));
//# sourceMappingURL=becsy.echo-d.min.js.map