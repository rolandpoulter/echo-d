{"version":3,"file":"runloop.echo-d.min.js","mappings":"cAAA,SAA2CA,EAAMC,GAC1B,iBAAZC,SAA0C,iBAAXC,OACxCA,OAAOD,QAAUD,IACQ,mBAAXG,QAAyBA,OAAOC,IAC9CD,OAAO,GAAIH,GACe,iBAAZC,QACdA,QAAe,MAAID,IAEnBD,EAAY,MAAIC,GACjB,CATD,CASqB,oBAAXK,OAAyBA,OAA2B,oBAAXC,OAAyBA,OAAyB,oBAATC,KAAuBA,KAAOC,MAAM,K,mVCRzH,SAASC,EAAcC,EAAQ,CAClCC,gBAAiB,GACjBC,aAAsC,mBAAjBA,EAA8BA,EAAeC,WAClEC,eAA0C,mBAAnBA,eAAgCA,eAAiBC,eAExE,MAAM,gBAAEJ,EAAe,aAAEC,EAAY,OAAEI,EAAM,GAAEC,GAAQP,EACvD,IAAIQ,EAAgB,KACpB,SAASC,EAAUC,EAAKC,EAAWC,EAAQC,IAAYC,GAAQ,IAAAC,OAAOC,GAAI,IAAAD,QAChD,OAAlBP,IACAA,EAAgBQ,GAEpB,MAAMC,EAAQD,EAAIR,EAGlB,GAFAA,EAAgBQ,EAChBJ,EAAME,MAAQA,EACc,mBAAjBZ,EACP,OAAOA,GAAa,IAAMQ,EAAGE,EAAOE,EAAOE,EAAIF,EAAOG,IAAQ,EAEtE,CACA,IAAIC,EAAgB,KACpB,SAASP,EAAUC,EAAQC,IAAYC,GAAQ,IAAAC,OAAOI,EAAY,EAAGF,EAAQ,GAiBzE,OAhBsB,OAAlBC,IACAA,EAAgB,GAEhBA,GAAiBjB,IACbM,GACAA,EAAGY,EAAWD,EAAeD,EAAOL,GAEpCA,EAAMN,QAAQc,MACdR,EAAMN,OAAOc,KAAK,QAASD,EAAWD,EAAeD,EAAOL,GAEhEM,EAAgB,GAEpBA,GAAiBD,EACZL,EAAMS,OACPT,EAAMU,aAAeb,EAAUE,EAAWC,EAAOE,GAAO,IAAAC,SAErDH,CACX,CACA,IAAIW,EAAS,CAAC,EACd,MAAMC,EAAW,CAAEC,QAASF,GAC5B,SAASV,EAASa,EAAa,CAACC,IAAD,GAAkBf,EAAQW,GAGrD,OAFAX,EAAMN,OAASM,EAAMN,QAAUA,EAC/BoB,EAAWd,EAAMN,QACVM,CACX,CAeA,MAAO,CACHD,YACAF,YACAI,WACAe,SAlBJ,SAAkBhB,GACdW,EAASX,EACTY,EAASC,QAAUF,CACvB,EAgBIjB,SACAe,KAhBJ,SAAcT,EAAQW,GAClBX,EAAMS,MAAO,EACTT,EAAMU,cACNlB,eAAeQ,EAAMU,aAE7B,EAYIR,MAXJ,SAAeF,EAAQW,EAAQM,EAAKpB,EAAWC,EAAKC,GAChDC,EAAMS,MAAO,EACbQ,EAAGnB,EAAIE,EACX,EASIA,MAAOY,EAEf,C","sources":["webpack://echoD/webpack/universalModuleDefinition","webpack://echoD/./lib/extra/runloop.js"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"echoD\"] = factory();\n\telse\n\t\troot[\"echoD\"] = factory();\n})(typeof window !== \"undefined\" ? window : typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : this, () => {\nreturn ","import { now } from '../utils.js';\nexport function createRunLoop(props = {\n    updateFrequency: 1000 / 50,\n    setImmediate: typeof setImmediate === 'function' ? setImmediate : setTimeout,\n    clearImmediate: typeof clearImmediate === 'function' ? clearImmediate : clearTimeout,\n}) {\n    const { updateFrequency, setImmediate, events, fn, } = props;\n    let lastFrameTime = null;\n    function nextCycle(nf = nextFrame, state = getState(), start = now(), n = now()) {\n        if (lastFrameTime === null) {\n            lastFrameTime = n;\n        }\n        const delta = n - lastFrameTime;\n        lastFrameTime = n;\n        state.start = start;\n        if (typeof setImmediate === 'function') {\n            return setImmediate(() => nf(state, start, n - start, delta), 0);\n        }\n    }\n    let lastEmitDelta = null;\n    function nextFrame(state = getState(), start = now(), timestamp = 0, delta = 0) {\n        if (lastEmitDelta === null) {\n            lastEmitDelta = 0;\n        }\n        if (lastEmitDelta >= updateFrequency) {\n            if (fn) {\n                fn(timestamp, lastEmitDelta, delta, state);\n            }\n            if (state.events?.emit) {\n                state.events.emit('frame', timestamp, lastEmitDelta, delta, state);\n            }\n            lastEmitDelta = 0;\n        }\n        lastEmitDelta += delta;\n        if (!state.stop) {\n            state.pendingFrame = nextCycle(nextFrame, state, start, now());\n        }\n        return state;\n    }\n    let _state = {};\n    const stateRef = { current: _state };\n    function getState(subscriber = (_events) => { }, state = _state) {\n        state.events = state.events || events;\n        subscriber(state.events);\n        return state;\n    }\n    function setState(state) {\n        _state = state;\n        stateRef.current = _state;\n    }\n    function stop(state = _state) {\n        state.stop = true;\n        if (state.pendingFrame) {\n            clearImmediate(state.pendingFrame);\n        }\n    }\n    function start(state = _state, nc = nextCycle, nf = nextFrame) {\n        state.stop = false;\n        nc(nf, state);\n    }\n    return {\n        nextFrame,\n        nextCycle,\n        getState,\n        setState,\n        events,\n        stop,\n        start,\n        state: stateRef,\n    };\n}\n"],"names":["root","factory","exports","module","define","amd","window","global","self","this","createRunLoop","props","updateFrequency","setImmediate","setTimeout","clearImmediate","clearTimeout","events","fn","lastFrameTime","nextCycle","nf","nextFrame","state","getState","start","now","n","delta","lastEmitDelta","timestamp","emit","stop","pendingFrame","_state","stateRef","current","subscriber","_events","setState","nc"],"sourceRoot":""}