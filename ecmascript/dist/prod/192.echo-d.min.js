"use strict";(Object("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).webpackChunkechoD=Object("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).webpackChunkechoD||[]).push([[192],{192:(e,t,r)=>{r.d(t,{createWorld:()=>ie,defineComponent:()=>H,removeComponent:()=>K,removeEntity:()=>_});var o="ui8",n="ui16",i="ui32",s="eid",y={i8:"Int8",ui8:"Uint8",ui8c:"Uint8Clamped",i16:"Int16",ui16:"Uint16",i32:"Int32",ui32:"Uint32",eid:"Uint32",f32:"Float32",f64:"Float64"},a={i8:Int8Array,ui8:Uint8Array,ui8c:Uint8ClampedArray,i16:Int16Array,ui16:Uint16Array,i32:Int32Array,ui32:Uint32Array,f32:Float32Array,f64:Float64Array,eid:Uint32Array},l=(4,e=>4*Math.ceil(e/4)),u=Symbol("storeRef"),b=Symbol("storeSize"),c=Symbol("storeMaps"),f=Symbol("storeFlattened"),m=Symbol("storeBase"),d=Symbol("storeType"),S=Symbol("storeArrayElementCounts"),p=Symbol("storeSubarrays"),h=Symbol("subarrayCursors"),w=Symbol("subarray"),E=(Symbol("subarrayFrom"),Symbol("subarrayTo"),Symbol("parentArray")),g=Symbol("tagStore"),A=(Symbol("queryShadow"),Symbol("serializeShadow"),Symbol("indexType")),v=Symbol("indexBytes"),O=Symbol("isEidType"),j={},k=e=>Array.isArray(e)&&"string"==typeof e[0]&&"number"==typeof e[1],M=()=>{const e=[],t=[];e.sort=function(r){const o=Array.prototype.sort.call(this,r);for(let r=0;r<e.length;r++)t[e[r]]=r;return o};const r=r=>e[t[r]]===r;return{add:o=>{r(o)||(t[o]=e.push(o)-1)},remove:o=>{if(!r(o))return;const n=t[o],i=e.pop();i!==o&&(e[n]=i,t[i]=n)},has:r,sparse:t,dense:e,reset:()=>{e.length=0,t.length=0}}},C=e=>t=>!e(t),T=(C((e=>e[f])),e=>"function"==typeof e&&e[z]),U=(C(T),Symbol("entityMasks")),I=Symbol("entityComponents"),R=Symbol("entitySparseSet"),q=Symbol("entityArray"),B=(Symbol("entityIndices"),Symbol("removedEntities"),1e5),x=()=>B,F=[],N=[],_=(e,t)=>{if(e[R].has(t)){e[L].forEach((r=>{V(e,r,t)})),e[oe]?N.push(t):F.push(t),e[R].remove(t),e[I].delete(t),e[te].delete(e[re].get(t)),e[re].delete(t);for(let r=0;r<e[U].length;r++)e[U][r][t]=0}},z=Symbol("$modifier"),L=Symbol("queries"),Q=Symbol("notQueries"),P=(Symbol("queryAny"),Symbol("queryAll"),Symbol("queryNone"),Symbol("queryMap")),Y=Symbol("$dirtyQueries"),$=(Symbol("queryComponents"),Symbol("enterQuery"),Symbol("exitQuery"),Object.freeze([]),(e,t)=>e.concat(t)),D=e=>t=>t.filter((t=>t.name===e().constructor.name)).reduce($),J=(D((function(...e){return function(){return e}})),D((function(...e){return function(){return e}})),D((function(...e){return function(){return e}})),(e,t,r)=>{const{masks:o,notMasks:n,generations:i}=t;for(let t=0;t<i.length;t++){const s=i[t],y=o[s],a=n[s],l=e[U][s][r];if(a&&0!=(l&a))return!1;if(y&&(l&y)!==y)return!1}return!0}),V=(e,t,r)=>{t.has(r)&&!t.toRemove.has(r)&&(t.toRemove.add(r),e[Y].add(t),t.exited.add(r))},W=Symbol("componentMap"),G=[],H=(e,t)=>{const r=((e,t)=>{const r=Symbol("store");if(!e||!Object.keys(e).length)return j[r]={[b]:t,[g]:!0,[m]:()=>j[r]},j[r];e=JSON.parse(JSON.stringify(e));const M={},C=e=>{const t=Object.keys(e);for(const r of t)k(e[r])?(M[e[r][0]]||(M[e[r][0]]=0),M[e[r][0]]+=e[r][1]):e[r]instanceof Object&&C(e[r])};C(e);const T={[b]:t,[c]:{},[p]:{},[u]:r,[h]:Object.keys(a).reduce(((e,t)=>({...e,[t]:0})),{}),[f]:[],[S]:M};if(e instanceof Object&&Object.keys(e).length){const u=(e,c)=>{if("string"==typeof e[c])e[c]=((e,t)=>{const r=t*a[e].BYTES_PER_ELEMENT,o=new ArrayBuffer(r),n=new a[e](o);return n[O]=e===s,n})(e[c],t),e[c][m]=()=>j[r],T[f].push(e[c]);else if(k(e[c])){const[t,u]=e[c];e[c]=((e,t,r)=>{const u=e[b],c=Array(u).fill(0);c[d]=t,c[O]=t===s;const f=e[h],m=r<=256?o:r<=65536?n:i;if(!r)throw new Error("bitECS - Must define component array length");if(!a[t])throw new Error(`bitECS - Invalid component array property type ${t}`);if(!e[p][t]){const r=e[S][t],o=new a[t](l(r*u));o[A]=y[m],o[v]=a[m].BYTES_PER_ELEMENT,e[p][t]=o}const g=f[t],j=g+u*r;f[t]=j,c[E]=e[p][t].subarray(g,j);for(let e=0;e<u;e++){const t=r*e,o=t+r;c[e]=c[E].subarray(t,o),c[e][A]=y[m],c[e][v]=a[m].BYTES_PER_ELEMENT,c[e][w]=!0}return c})(T,t,u),e[c][m]=()=>j[r],T[f].push(e[c])}else e[c]instanceof Object&&(e[c]=Object.keys(e[c]).reduce(u,e[c]));return e};return j[r]=Object.assign(Object.keys(e).reduce(u,e),T),j[r][m]=()=>j[r],j[r]}})(e,t||x());return e&&Object.keys(e).length&&G.push(r),r},K=(e,t,r,o=!0)=>{if(void 0===r)throw new Error("bitECS - entity is undefined.");if(!e[R].has(r))throw new Error("bitECS - entity does not exist in the world.");if(!((e,t,r)=>{const o=e[W].get(t);if(!o)return!1;const{generationId:n,bitflag:i}=o;return(e[U][n][r]&i)===i})(e,t,r))return;const n=e[W].get(t),{generationId:i,bitflag:s,queries:y}=n;e[U][i][r]&=~s,y.forEach((t=>{t.toRemove.remove(r);const o=J(e,t,r);o&&(t.exited.remove(r),((e,t)=>{e.toRemove.remove(t),e.entered.add(t),e.add(t)})(t,r)),o||(t.entered.remove(r),V(e,t,r))})),e[I].get(r).delete(t),o&&((e,t)=>{e[f]&&e[f].forEach((e=>{ArrayBuffer.isView(e)?e[t]=0:e[t].fill(0)}))})(t,r)},X=Symbol("size"),Z=(Symbol("resizeThreshold"),Symbol("bitflag")),ee=Symbol("archetypes"),te=Symbol("localEntities"),re=Symbol("localEntityLookup"),oe=Symbol("manualEntityRecycling"),ne=[],ie=(...e)=>{const t="object"==typeof e[0]?e[0]:{},r="number"==typeof e[0]?e[0]:"number"==typeof e[1]?e[1]:x();return se(t,r),ne.push(t),t},se=(e,t=x())=>(e[X]=t,e[q]&&e[q].forEach((t=>_(e,t))),e[U]=[new Uint32Array(t)],e[I]=new Map,e[ee]=[],e[R]=M(),e[q]=e[R].dense,e[Z]=1,e[W]=new Map,e[P]=new Map,e[L]=new Set,e[Q]=new Set,e[Y]=new Set,e[te]=new Map,e[re]=new Map,e[oe]=!1,e)}}]);
//# sourceMappingURL=192.echo-d.min.js.map